<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=content-type content="text/html; charset=utf-8"><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>ElasticSearch sharding work | A Place for Poor Examples</title><meta name=description content="ElasticSearch sharding work"><meta name=keywords content="JavaScript, HTML, software, development, blog, examples, derby, cracking, coding, interview, CoffeeScript, node, express, .NET, C#, ASP.NET, Ember, Knockout, Angular, algorithms, analysis, analytics"><meta name=author content="Matt Blair"><meta name=google-site-verification content=pLaNxAD_C5VD6yWlQnX9ScKil_pSvI3lXz-9k4nOyYU><meta name=generator content="DocPad v6.79.4"><meta name=viewport content="width=device-width"><link rel="shortcut icon" href=/images/icons/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=/images/icons/apple-touch-icon-144-precomposed.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/images/icons/apple-touch-icon-114-precomposed.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/images/icons/apple-touch-icon-72-precomposed.png><link rel=apple-touch-icon-precomposed href=/images/icons/apple-touch-icon-57-precomposed.png><link rel=stylesheet href=/styles/twitter-bootstrap.css><link rel=stylesheet href=/styles/style.css><link rel=stylesheet href=/styles/mono-blue.css><link href=/atom.xml type=application/atom+xml rel=alternate title=Posts></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse><span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="/">A Place for Poor Examples</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"><li typeof=sioc:Page about=/pages/about.html><a href=/pages/about.html property=dc:title>About</a></li><li typeof=sioc:Page about=/pages/posts.html><a href=/pages/posts.html property=dc:title>Posts</a></li><li typeof=sioc:Page about=/pages/hockey-stuff.html><a href=/pages/hockey-stuff.html property=dc:title>Hobbies</a></li></ul></div></div></div><div class=container><section id=content class=content><div class=row><div class=col-lg-9><article id=elasticsearch-sharding-work class=post><div class=post-content><h1 class=post-title>ElasticSearch sharding work</h1><div class=post-date>Mon Mar 05 2018</div><p>Wanted to share some insights my team has found with changing sharding strategies for ElasticSearch (ES).</p><p>Today we moved 100% of my work&#39;s search and autocomplete queries from a mutli-sharded index to a single-sharded index.</p><p><em>Short version: Reducing shard count reduces system load, CPU usage, mostly positive results on performance.</em></p><p>Medium version: In moving 100% of our searches and autocomplete queries from a mutli-sharded index to a single-sharded index, we saw drops in cluster load, queries generated by ES, and overall ES CPU usage.</p><p><img class=small style="padding-bottom: 10px" alt="Total Search Load" src=/images/posts/es-shard-1.png> <img class=small style="padding-bottom: 10px" alt="Top CPU Load" src=/images/posts/es-shard-2.png> <img class=small style="padding-bottom: 10px" alt="ElasticSearch Load" src=/images/posts/es-shard-3.png></p><p>We saw improvements in response time for retrieval and ranking from search.</p><p><img class=small style="padding-bottom: 10px" alt="Search Client" src=/images/posts/es-shard-4.png> <img class=small style="padding-bottom: 10px" alt="Ranking Client" src=/images/posts/es-shard-5.png></p><p>Along with response time drops, we saw a smoothing of response times from search in general.</p><p><img class=small style="padding-bottom: 10px" alt="Search TP95" src=/images/posts/es-shard-6.png></p><p>Average query &amp; fetch times increased. While we reduced the total number of queries ES generated, each of those queries and fetches was doing more work.</p><p><img class=small style="padding-bottom: 10px" alt="Fetch TP95" src=/images/posts/es-shard-7.png> <img class=small style="padding-bottom: 10px" alt="Query TP95" src=/images/posts/es-shard-8.png></p><p>We managed to reduce response from search but autocomplete (which uses the same indice) saw its average response time increase. The response time is now much more stable, and the service performs better under high load. In the graph below, the red line is autocomplete with a single shard, the yellow line is the 5-shard autocomplete response time. As our load increased during the day today, you can see the 5-shard performance steadily decrease while the single shard response remained steady.</p><p><img class=small style="padding-bottom: 10px" alt="Autocomplete TP95" src=/images/posts/es-shard-9.png></p></div></article><footer><div id=disqus_thread></div><script type=text/javascript>
        var disqus_shortname = 'codetype';
        var disqus_identifier = 'elasticsearch-sharding-work';
        var disqus_title = 'ElasticSearch sharding work';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></footer></div><div class="col-lg-3 hidden-xs hidden-sm"><nav class=link-list><h3>Recent Posts</h3><div class=recent-post><a class=title href=/posts/20180115-manager-conference-links.html>Manager Conference Links</a></div><div class=recent-post><a class=title href=/posts/20181121-elasticsearch-perf-work.html>ElasticSearch Perf - Highlighter Edition</a></div><div class=recent-post><a class=title href=/posts/20180908-moment-js-alternatives.html>Moment.js alternatives</a></div><div class=recent-post><a class=title href=/posts/20180601-manager-readme.html>Manager READMEs</a></div><div class=recent-post><a class=title href=/posts/20180305-elasticsearch-sharding-work.html>ElasticSearch sharding work</a></div><div class=recent-post><a class=title href=/posts/20171229-engineering-management-classes.html>Engineering Management Classes</a></div></nav></div></div></section></div><script defer src=//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script defer src=//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script><script defer src=/vendor/twitter-bootstrap/dist/js/bootstrap.min.js></script><script defer src=/scripts/script.js></script><script defer src=/scripts/analytics.js></script></body></html>