<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=content-type content="text/html; charset=utf-8"><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>ElasticSearch Perf - Highlighter Edition | A Place for Poor Examples</title><meta name=description content="Examine sharding and highlighting strategy with ES"><meta name=keywords content="JavaScript, HTML, software, development, blog, examples, derby, cracking, coding, interview, CoffeeScript, node, express, .NET, C#, ASP.NET, Ember, Knockout, Angular, algorithms, analysis, analytics"><meta name=author content="Matt Blair"><meta name=google-site-verification content=pLaNxAD_C5VD6yWlQnX9ScKil_pSvI3lXz-9k4nOyYU><meta name=generator content="DocPad v6.79.4"><meta name=viewport content="width=device-width"><link rel="shortcut icon" href=/images/icons/favicon.ico><link rel=apple-touch-icon-precomposed sizes=144x144 href=/images/icons/apple-touch-icon-144-precomposed.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/images/icons/apple-touch-icon-114-precomposed.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/images/icons/apple-touch-icon-72-precomposed.png><link rel=apple-touch-icon-precomposed href=/images/icons/apple-touch-icon-57-precomposed.png><link rel=stylesheet href=/styles/twitter-bootstrap.css><link rel=stylesheet href=/styles/style.css><link rel=stylesheet href=/styles/mono-blue.css><link href=/atom.xml type=application/atom+xml rel=alternate title=Posts></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse><span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="/">A Place for Poor Examples</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"><li typeof=sioc:Page about=/pages/about.html><a href=/pages/about.html property=dc:title>About</a></li><li typeof=sioc:Page about=/pages/posts.html><a href=/pages/posts.html property=dc:title>Posts</a></li><li typeof=sioc:Page about=/pages/hockey-stuff.html><a href=/pages/hockey-stuff.html property=dc:title>Hobbies</a></li></ul></div></div></div><div class=container><section id=content class=content><div class=row><div class=col-lg-9><article id=elasticsearch-perf-work class=post><div class=post-content><h1 class=post-title>ElasticSearch Perf - Highlighter Edition</h1><div class=post-date>Wed Nov 21 2018</div><p>Wanted to share the results of the work we&#39;ve been doing to improve performance and stabilize our ES cluster.</p><p>Short Version: Changing sharding and &quot;highlighting&quot; strategies when doing FreeText searches dramatically impacts performance.</p><p>Long Version: We&#39;ve been load testing various aspects of search to pinpoint features we use that create large amounts of load on the system. Our initial research pointed at normal searches and freetext searches as being problematic.</p><p>One of the tests we ran examined &quot;highlighting&quot; in freetext search. &quot;Highlighting&quot; is the selection of relevant criteria when you search for words or phrases in a document.</p><p>The graph below is an illustration of some load testing we did around highlighting. The red squares represent, in order of appearance:</p><ol><li>5 shards, highlighting freetext results</li><li>1 shard, highlighting freetext results</li><li>5 shares, no highlighting, freetext results</li><li>1 shard, no highlighting, freetext results</li></ol><p><img alt="Load Test: 5 shards vs 1 Shard, Highlighting on/off" src=/images/posts/es-highlighter-1.png></p><p>Our conclusions from these graphs:</p><ol><li>5 shards w/ highlighting takes a long time and a lot of resources</li><li>1 shard w/o highlighting is fast and doesn&#39;t use many resources</li></ol><p>In researching highlighting, we found there are different ways to highlight results. We were using the default highlighter - the &quot;plain&quot; highlighter. There are other highlighters - the &quot;unified&quot; highlighter, for some example - that along with some index changes, promised significant performance improvements.</p><p>In this graph, the dots on the left represent the performance of the &quot;plain&quot; highlighter, while the dots on the right represent the &quot;unified&quot; highlighter.</p><p><img alt="Load Test: Plain vs Unified Highlighting" src=/images/posts/es-highlighter-2.png></p><p>It appears that a &quot;unified&quot; highlighter strategy is more performant than our original &quot;plain&quot; highlighter.</p><p>Late today, we launched a new experiment with three indices:</p><ol><li>Control (5 Shards, &quot;plain&quot; highlighter)</li><li>Variant 1 (1 Shard, &quot;plain&quot; highlighter)</li><li>Variant 2 (1 Shard, &quot;unified&quot; highlighter)</li></ol><p>Here is a graph of the overall performance of the experiment so far:</p><p><img alt="ElasticSearch Performance graph" src=/images/posts/es-highlighter-3.png></p><p>Red line (top): Variant 1. TP95: 1.7 seconds A single sharded strategy with the &quot;plain&quot; highlighter is much slower, though it consumes less ES resources than the 5 shard strategy.</p><p>Orange line (middle): Control. TP95: 600 ms 5 shards with the &quot;plain&quot; highlighter responds must faster than a single shard, but it consumes more ES resources to run than the 1 shard strategy.</p><p>Blue line (bottom): Variant 2. TP95: 150 ms A single shard, using the &quot;unified&quot; highlighter, is much more performant, and uses less system resources, than the other two variants.</p></div></article><footer><div id=disqus_thread></div><script type=text/javascript>
        var disqus_shortname = 'codetype';
        var disqus_identifier = 'elasticsearch-perf-work';
        var disqus_title = 'ElasticSearch Perf - Highlighter Edition';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></footer></div><div class="col-lg-3 hidden-xs hidden-sm"><nav class=link-list><h3>Recent Posts</h3><div class=recent-post><a class=title href=/posts/20180115-manager-conference-links.html>Manager Conference Links</a></div><div class=recent-post><a class=title href=/posts/20181121-elasticsearch-perf-work.html>ElasticSearch Perf - Highlighter Edition</a></div><div class=recent-post><a class=title href=/posts/20180908-moment-js-alternatives.html>Moment.js alternatives</a></div><div class=recent-post><a class=title href=/posts/20180601-manager-readme.html>Manager READMEs</a></div><div class=recent-post><a class=title href=/posts/20180305-elasticsearch-sharding-work.html>ElasticSearch sharding work</a></div><div class=recent-post><a class=title href=/posts/20171229-engineering-management-classes.html>Engineering Management Classes</a></div></nav></div></div></section></div><script defer src=//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script defer src=//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script><script defer src=/vendor/twitter-bootstrap/dist/js/bootstrap.min.js></script><script defer src=/scripts/script.js></script><script defer src=/scripts/analytics.js></script></body></html>